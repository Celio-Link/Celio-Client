<div class="flex w-full flex-col">
  <ul class="steps w-full">
    <li class="step font-Gen3 text-2xl" [ngClass]="{ 'step-primary': stepState >= 0 }">Connect Celio Device</li>
    <li class="step font-Gen3 text-2xl" [ngClass]="{ 'step-primary': stepState >= 1 }">Join Session</li>
    <li class="step font-Gen3 text-2xl" [ngClass]="{ 'step-primary': stepState >= 2 }">Wait for Partner</li>
    <li class="step font-Gen3 text-2xl" [ngClass]="{ 'step-primary': stepState >= 3 }">Start Link Mode</li>
    <li class="step font-Gen3 text-2xl" [ngClass]="{ 'step-primary': stepState >= 4 }">Ready</li>
  </ul>

  <div class="divider"></div>

  <div class="box relative">
    <div class="flex w-full h-[5rem]">
      <div *ngIf="isCurrentlyIn(StepsState.ConnectingCelioDevice)" class="card rounded-box grid grow place-items-center">
        <button (click)="connect()" class="btn btn-lg">Connect Celio Device</button>
      </div>
      <div *ngIf="hasReached(StepsState.JoiningSession)" class="font-Gen3 text-4xl">
        Celio USB connection status: <br>
        Ready!
      </div>
      <div *ngIf="webUsbError" class="font-Gen3 text-4xl">
        Web USB is not supported by this browser. Firefox sadly does not support web USB currently.<br>
        Please use Chrome or another Chromium based browser.
      </div>
    </div>
    <img *ngIf="isCurrentlyIn(StepsState.ConnectingCelioDevice)" src="assets/down_arrow.png" class="animate-bob absolute bottom-3 right-2 w-6 h-6 image-pixelated" />
  </div>

  <div class="divider"></div>

  <div [class.opacity-100]="hasReached(StepsState.JoiningSession)" class="transition-opacity opacity-0 duration-500 ease-in-out">
    <div class="box relative">

      <div *ngIf="isCurrentlyIn(StepsState.JoiningSession)" class="flex w-full h-[5rem]">
        <div class="card rounded-box grid grow place-items-center">
          <button (click)="createSession()" class="btn btn-lg">Create Session</button>
        </div>
        <div class="divider divider-horizontal"><div class="font-Gen3 text-4xl">OR</div></div>
        <div class="card rounded-box grid grow place-items-center">
          <input #sessionInput (keydown.enter)="joinSession(sessionInput.value)" type="text" placeholder="Enter Session Id" class="input input-lg w-3xs font-Gen3 text-2xl" />
        </div>
      </div>

      <div *ngIf="hasReached(StepsState.WaitingForPartner)" class="flex w-full h-[5rem]">
        <div class="font-Gen3 text-4xl">
          Connected to Session: <br>
          {{sessionId}}
        </div>
      </div>
      <button *ngIf=hasReached(StepsState.WaitingForPartner) (click)="leaveSession()" class="btn btn-sm text-2xl absolute bottom-3 right-2">Leave Session</button>
      <img *ngIf="isCurrentlyIn(StepsState.JoiningSession)" src="assets/down_arrow.png" class="animate-bob absolute bottom-3 right-2 w-6 h-6 image-pixelated" />

    </div>
    <div class="divider"></div>
  </div>

  <div [class.opacity-100]="hasReached(StepsState.WaitingForPartner)" class="transition-opacity opacity-0 duration-500 ease-in-out">
    <div class="box relative">
      <div *ngIf="isCurrentlyIn(StepsState.WaitingForPartner)" class="flex w-full h-[5rem]">
          <p class="font-Gen3 text-4xl waiting">
            Waiting for Partner<span class="dots"></span>
          </p>
      </div>
      <div *ngIf="hasReached(StepsState.SettingLinkMode)" class="flex w-full h-[5rem]">
        <p class="font-Gen3 text-4xl waiting">
          Waiting for Partner... <br>
          Partner has connected!
        </p>
      </div>
    </div>
    <div class="divider"></div>
  </div>

  <div [class.opacity-100]="hasReached(StepsState.SettingLinkMode)" class="transition-opacity opacity-0 duration-500 ease-in-out">
    <div class="box relative">
      <div class="flex w-full h-[5rem]">
        <div class="card rounded-box grid h-20 grow place-items-center">
          <button (click)="start()" class="btn btn-lg">Start</button>
        </div>
        <img *ngIf="isCurrentlyIn(StepsState.SettingLinkMode)" src="assets/down_arrow.png" class="animate-bob absolute bottom-3 right-2 w-6 h-6 image-pixelated" />
      </div>
    </div>
  </div>

  <div *ngIf="hasReached(StepsState.Ready)"
       class="fixed inset-0 bg-black/70 z-[9999] flex items-center justify-center transition-opacity duration-500 ease-in-out">

    <div class="card rounded-box bg-white h-auto w-full max-w-screen-xl mx-auto flex flex-col items-center justify-between p-8 relative">


      <div class="flex justify-between items-center w-full relative">
        <img src="assets/PC.png" class="image-pixelated h-48 w-auto relative ml-[8rem] bottom-1"/>
        <div class="bg-black h-2 w-[100%] relative"></div>
        <button (click)="disconnect()" class="btn btn-lg btn-dash btn-error mt-8 relative bottom-4">
          Disconnect
        </button>
        <div class="bg-black h-2 w-[100%] relative -mr-[12px]"></div>
        <img src="assets/GBA.png" class="image-pixelated h-48 w-auto relative mr-[8rem]"/>
      </div>

      <div class="box mt-12 font-Gen3 text-4xl">
        Link Mode is now ready! If you haven't already, connect the <br>
        Link-Cable to your Gameboy Advance and talk to the Pok√©mon Center clerk.
      </div>
    </div>
  </div>
</div>

<app-toast></app-toast>
